
<!DOCTYPE HTML>
<html lang="us-en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Plugins · Composer 英文文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="repository-priorities.html" />
    
    
    <link rel="prev" href="handling-private-packages.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://docs.khs1994.com" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Articles
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="aliases.html">
            
                <a href="aliases.html">
            
                    
                    Aliases
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="authentication-for-private-packages.html">
            
                <a href="authentication-for-private-packages.html">
            
                    
                    Authentication For Private Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="autoloader-optimization.html">
            
                <a href="autoloader-optimization.html">
            
                    
                    Autoloader Optimization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="custom-installers.html">
            
                <a href="custom-installers.html">
            
                    
                    Custom Installers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="handling-private-packages.html">
            
                <a href="handling-private-packages.html">
            
                    
                    Handling Private Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.6" data-path="plugins.html">
            
                <a href="plugins.html">
            
                    
                    Plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="repository-priorities.html">
            
                <a href="repository-priorities.html">
            
                    
                    Repository Priorities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="resolving-merge-conflicts.html">
            
                <a href="resolving-merge-conflicts.html">
            
                    
                    Resolving Merge Conflicts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="scripts.html">
            
                <a href="scripts.html">
            
                    
                    Scripts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="troubleshooting.html">
            
                <a href="troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="vendor-binaries.html">
            
                <a href="vendor-binaries.html">
            
                    
                    Vendor Binaries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="versions.html">
            
                <a href="versions.html">
            
                    
                    Versions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Dev
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../dev/DefaultPolicy.html">
            
                <a href="../dev/DefaultPolicy.html">
            
                    
                    Default Policy
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Faqs
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../faqs/how-do-i-install-a-package-to-a-custom-path-for-my-framework.html">
            
                <a href="../faqs/how-do-i-install-a-package-to-a-custom-path-for-my-framework.html">
            
                    
                    How Do I Install A Package To A Custom Path For My Framework
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../faqs/how-to-install-composer-programmatically.html">
            
                <a href="../faqs/how-to-install-composer-programmatically.html">
            
                    
                    How To Install Composer Programmatically
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../faqs/how-to-install-untrusted-packages-safely.html">
            
                <a href="../faqs/how-to-install-untrusted-packages-safely.html">
            
                    
                    How To Install Untrusted Packages Safely
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../faqs/should-i-commit-the-dependencies-in-my-vendor-directory.html">
            
                <a href="../faqs/should-i-commit-the-dependencies-in-my-vendor-directory.html">
            
                    
                    Should I Commit The Dependencies In My Vendor Directory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../faqs/which-version-numbering-system-does-composer-itself-use.html">
            
                <a href="../faqs/which-version-numbering-system-does-composer-itself-use.html">
            
                    
                    Which Version Numbering System Does Composer Itself Use
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../faqs/why-are-unbound-version-constraints-a-bad-idea.html">
            
                <a href="../faqs/why-are-unbound-version-constraints-a-bad-idea.html">
            
                    
                    Why Are Unbound Version Constraints A Bad Idea
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../faqs/why-are-version-constraints-combining-comparisons-and-wildcards-a-bad-idea.html">
            
                <a href="../faqs/why-are-version-constraints-combining-comparisons-and-wildcards-a-bad-idea.html">
            
                    
                    Why Are Version Constraints Combining Comparisons And Wildcards A Bad Idea
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../faqs/why-can't-composer-load-repositories-recursively.html">
            
                <a href="../faqs/why-can't-composer-load-repositories-recursively.html">
            
                    
                    Why Can T Composer Load Repositories Recursively
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../fixtures/fixtures.html">
            
                <a href="../fixtures/fixtures.html">
            
                    
                    Fixtures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../01-basic-usage.html">
            
                <a href="../01-basic-usage.html">
            
                    
                    01 Basic Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../02-libraries.html">
            
                <a href="../02-libraries.html">
            
                    
                    02 Libraries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../03-cli.html">
            
                <a href="../03-cli.html">
            
                    
                    03 Cli
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../04-schema.html">
            
                <a href="../04-schema.html">
            
                    
                    04 Schema
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../05-repositories.html">
            
                <a href="../05-repositories.html">
            
                    
                    05 Repositories
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../06-config.html">
            
                <a href="../06-config.html">
            
                    
                    06 Config
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../07-runtime.html">
            
                <a href="../07-runtime.html">
            
                    
                    07 Runtime
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../08-community.html">
            
                <a href="../08-community.html">
            
                    
                    08 Community
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Plugins</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <!--
    tagline: Modify and extend Composer's functionality
-->
<h1 id="setting-up-and-using-plugins">Setting up and using plugins</h1>
<h2 id="synopsis">Synopsis</h2>
<p>You may wish to alter or expand Composer&apos;s functionality with your own. For
example if your environment poses special requirements on the behaviour of
Composer which do not apply to the majority of its users or if you wish to
accomplish something with Composer in a way that is not desired by most users.</p>
<p>In these cases you could consider creating a plugin to handle your
specific logic.</p>
<h2 id="creating-a-plugin">Creating a Plugin</h2>
<p>A plugin is a regular Composer package which ships its code as part of the
package and may also depend on further packages.</p>
<h3 id="plugin-package">Plugin Package</h3>
<p>The package file is the same as any other package file but with the following
requirements:</p>
<ol>
<li>The <a href="../04-schema.html#type">type</a> attribute must be <code>composer-plugin</code>.</li>
<li>The <a href="../04-schema.html#extra">extra</a> attribute must contain an element <code>class</code> defining the
class name of the plugin (including namespace). If a package contains
multiple plugins, this can be array of class names.</li>
<li>You must require the special package called <code>composer-plugin-api</code>
to define which Plugin API versions your plugin is compatible with.
Requiring this package doesn&apos;t actually include any extra dependencies,
it only specifies which version of the plugin API to use.</li>
</ol>
<blockquote>
<p><strong>Note:</strong> When developing a plugin, although not required, it&apos;s useful to add
a require-dev dependency on <code>composer/composer</code> to have IDE auto completion on Composer classes.</p>
</blockquote>
<p>The required version of the <code>composer-plugin-api</code> follows the same <a href="../01-basic-usage.html#package-versions">rules</a>
as a normal package&apos;s.</p>
<p>The current Composer plugin API version is <code>2.0.0</code>.</p>
<p>An example of a valid plugin <code>composer.json</code> file (with the autoloading
part omitted and an optional require-dev dependency on <code>composer/composer</code> for IDE auto completion):</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my/plugin-package&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;composer-plugin&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;require&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;composer-plugin-api&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;require-dev&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;composer/composer&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;extra&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;class&quot;</span><span class="token operator">:</span> <span class="token string">&quot;My\\Plugin&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="plugin-class">Plugin Class</h3>
<p>Every plugin has to supply a class which implements the
<a href="https://github.com/composer/composer/blob/master/src/Composer/Plugin/PluginInterface.php" target="_blank"><code>Composer\Plugin\PluginInterface</code></a>. The <code>activate()</code> method of the plugin
is called after the plugin is loaded and receives an instance of
<a href="https://github.com/composer/composer/blob/master/src/Composer/Composer.php" target="_blank"><code>Composer\Composer</code></a> as well as an instance of
<a href="https://github.com/composer/composer/blob/master/src/Composer/IO/IOInterface.php" target="_blank"><code>Composer\IO\IOInterface</code></a>. Using these two objects all configuration can
be read and all internal objects and state can be manipulated as desired.</p>
<p>Example:</p>
<pre class="language-"><code class="lang-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">phpDocumentor<span class="token punctuation">\</span>Composer</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Composer</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>IO<span class="token punctuation">\</span>IOInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Plugin<span class="token punctuation">\</span>PluginInterface</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TemplateInstallerPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">PluginInterface</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">activate</span><span class="token punctuation">(</span>Composer <span class="token variable">$composer</span><span class="token punctuation">,</span> IOInterface <span class="token variable">$io</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$installer</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplateInstaller</span><span class="token punctuation">(</span><span class="token variable">$io</span><span class="token punctuation">,</span> <span class="token variable">$composer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$composer</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getInstallationManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">addInstaller</span><span class="token punctuation">(</span><span class="token variable">$installer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="event-handler">Event Handler</h2>
<p>Furthermore plugins may implement the
<a href="https://github.com/composer/composer/blob/master/src/Composer/EventDispatcher/EventSubscriberInterface.php" target="_blank"><code>Composer\EventDispatcher\EventSubscriberInterface</code></a> in order to have its
event handlers automatically registered with the <code>EventDispatcher</code> when the
plugin is loaded.</p>
<p>To register a method to an event, implement the method <code>getSubscribedEvents()</code>
and have it return an array. The array key must be the
<a href="https://getcomposer.org/doc/articles/scripts.md#event-names" target="_blank">event name</a>
and the value is the name of the method in this class to be called.</p>
<blockquote>
<p><strong>Note:</strong> If you don&apos;t know which event to listen to, you can run a Composer
command with the COMPOSER_DEBUG_EVENTS=1 environment variable set, which might
help you identify what event you are looking for.</p>
</blockquote>
<pre class="language-"><code class="lang-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getSubscribedEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token single-quoted-string string">&apos;post-autoload-dump&apos;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">&apos;methodToBeCalled&apos;</span><span class="token punctuation">,</span>
        <span class="token comment">// ^ event name ^         ^ method name ^</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>By default, the priority of an event handler is set to 0. The priority can be
changed by attaching a tuple where the first value is the method name, as
before, and the second value is an integer representing the priority.
Higher integers represent higher priorities. Priority 2 is called before
priority 1, etc.</p>
<pre class="language-"><code class="lang-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getSubscribedEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token comment">// Will be called before events with priority 0</span>
        <span class="token single-quoted-string string">&apos;post-autoload-dump&apos;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">&apos;methodToBeCalled&apos;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>If multiple methods should be called, then an array of tuples can be attached
to each event. The tuples do not need to include the priority. If it is
omitted, it will default to 0.</p>
<pre class="language-"><code class="lang-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getSubscribedEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token single-quoted-string string">&apos;post-autoload-dump&apos;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">&apos;methodToBeCalled&apos;</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Priority defaults to 0</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">&apos;someOtherMethodName&apos;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// This fires first</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Here&apos;s a complete example:</p>
<pre class="language-"><code class="lang-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">Naderman<span class="token punctuation">\</span>Composer<span class="token punctuation">\</span>AWS</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Composer</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>EventDispatcher<span class="token punctuation">\</span>EventSubscriberInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>IO<span class="token punctuation">\</span>IOInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Plugin<span class="token punctuation">\</span>PluginInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Plugin<span class="token punctuation">\</span>PluginEvents</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Plugin<span class="token punctuation">\</span>PreFileDownloadEvent</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">AwsPlugin</span> <span class="token keyword">implements</span> <span class="token class-name">PluginInterface</span><span class="token punctuation">,</span> EventSubscriberInterface
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token variable">$composer</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$io</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">activate</span><span class="token punctuation">(</span>Composer <span class="token variable">$composer</span><span class="token punctuation">,</span> IOInterface <span class="token variable">$io</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">composer</span> <span class="token operator">=</span> <span class="token variable">$composer</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">io</span> <span class="token operator">=</span> <span class="token variable">$io</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">deactivate</span><span class="token punctuation">(</span>Composer <span class="token variable">$composer</span><span class="token punctuation">,</span> IOInterface <span class="token variable">$io</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">uninstall</span><span class="token punctuation">(</span>Composer <span class="token variable">$composer</span><span class="token punctuation">,</span> IOInterface <span class="token variable">$io</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getSubscribedEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            PluginEvents<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">PRE_FILE_DOWNLOAD</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token single-quoted-string string">&apos;onPreFileDownload&apos;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">onPreFileDownload</span><span class="token punctuation">(</span>PreFileDownloadEvent <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$protocol</span> <span class="token operator">=</span> <span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getProcessedUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">PHP_URL_SCHEME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$protocol</span> <span class="token operator">===</span> <span class="token single-quoted-string string">&apos;s3&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="plugin-capabilities">Plugin capabilities</h2>
<p>Composer defines a standard set of capabilities which may be implemented by plugins.
Their goal is to make the plugin ecosystem more stable as it reduces the need to mess
with <a href="https://github.com/composer/composer/blob/master/src/Composer/Composer.php" target="_blank"><code>Composer\Composer</code></a>&apos;s internal state, by providing explicit extension points
for common plugin requirements.</p>
<p>Capable Plugins classes must implement the <a href="https://github.com/composer/composer/blob/master/src/Composer/Plugin/Capable.php" target="_blank"><code>Composer\Plugin\Capable</code></a> interface
and declare their capabilities in the <code>getCapabilities()</code> method.
This method must return an array, with the <em>key</em> as a Composer Capability class name,
and the <em>value</em> as the Plugin&apos;s own implementation class name of said Capability:</p>
<pre class="language-"><code class="lang-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">My<span class="token punctuation">\</span>Composer</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Composer</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>IO<span class="token punctuation">\</span>IOInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Plugin<span class="token punctuation">\</span>PluginInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Plugin<span class="token punctuation">\</span>Capable</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Plugin</span> <span class="token keyword">implements</span> <span class="token class-name">PluginInterface</span><span class="token punctuation">,</span> Capable
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">activate</span><span class="token punctuation">(</span>Composer <span class="token variable">$composer</span><span class="token punctuation">,</span> IOInterface <span class="token variable">$io</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getCapabilities</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token single-quoted-string string">&apos;Composer\Plugin\Capability\CommandProvider&apos;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">&apos;My\Composer\CommandProvider&apos;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="command-provider">Command provider</h3>
<p>The <a href="https://github.com/composer/composer/blob/master/src/Composer/Plugin/Capability/CommandProvider.php" target="_blank"><code>Composer\Plugin\Capability\CommandProvider</code></a> capability allows to register
additional commands for Composer:</p>
<pre class="language-"><code class="lang-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">My<span class="token punctuation">\</span>Composer</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Plugin<span class="token punctuation">\</span>Capability<span class="token punctuation">\</span>CommandProvider</span> <span class="token keyword">as</span> CommandProviderCapability<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Input<span class="token punctuation">\</span>InputInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Output<span class="token punctuation">\</span>OutputInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Command<span class="token punctuation">\</span>BaseCommand</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CommandProvider</span> <span class="token keyword">implements</span> <span class="token class-name">CommandProviderCapability</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getCommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Command</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Command</span> <span class="token keyword">extends</span> <span class="token class-name">BaseCommand</span>
<span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token single-quoted-string string">&apos;custom-plugin-command&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span>InputInterface <span class="token variable">$input</span><span class="token punctuation">,</span> OutputInterface <span class="token variable">$output</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$output</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">writeln</span><span class="token punctuation">(</span><span class="token single-quoted-string string">&apos;Executing&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now the <code>custom-plugin-command</code> is available alongside Composer commands.</p>
<blockquote>
<p><em>Composer commands are based on the <a href="https://symfony.com/doc/current/components/console.html" target="_blank">Symfony Console Component</a>.</em></p>
</blockquote>
<h2 id="running-plugins-manually">Running plugins manually</h2>
<p>Plugins for an event can be run manually by the <code>run-script</code> command. This works the same way as
<a href="scripts.html#running-scripts-manually">running scripts manually</a>.</p>
<h2 id="using-plugins">Using Plugins</h2>
<p>Plugin packages are automatically loaded as soon as they are installed and will
be loaded when Composer starts up if they are found in the current project&apos;s
list of installed packages. Additionally all plugin packages installed in the
<code>COMPOSER_HOME</code> directory using the Composer global command are loaded before
local project plugins are loaded.</p>
<blockquote>
<p>You may pass the <code>--no-plugins</code> option to Composer commands to disable all
installed plugins. This may be particularly helpful if any of the plugins
causes errors and you wish to update or uninstall it.</p>
</blockquote>
<h2 id="plugin-helpers">Plugin Helpers</h2>
<p>As of Composer 2, due to the fact that DownloaderInterface can sometimes return Promises
and have been split up in more steps than they used to, we provide a <a href="https://github.com/composer/composer/blob/master/src/Composer/Util/SyncHelper.php" target="_blank">SyncHelper</a>
to make downloading and installing packages easier.</p>
<h2 id="plugin-extra-attributes">Plugin Extra Attributes</h2>
<p>A few special plugin capabilities can be unlocked using extra attributes in the plugin&apos;s composer.json.</p>
<h3 id="class">class</h3>
<p><a href="#plugin-package">See above</a> for an explanation of the class attribute and how it works.</p>
<h3 id="plugin-modifies-downloads">plugin-modifies-downloads</h3>
<p>Some special plugins need to update package download URLs before they get downloaded.</p>
<p>As of Composer 2.0, all packages are downloaded before they get installed. This means
on the first installation, your plugin is not yet installed when the download occurs,
and it does not get a chance to update the URLs on time.</p>
<p>Specifying <code>{&quot;extra&quot;: {&quot;plugin-modifies-downloads&quot;: true}}</code> in your composer.json will
hint to Composer that the plugin should be installed on its own before proceeding with
the rest of the package downloads. This slightly slows down the overall installation
process however, so do not use it in plugins which do not absolutely require it.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="handling-private-packages.html" class="navigation navigation-prev " aria-label="Previous page: Handling Private Packages">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="repository-priorities.html" class="navigation navigation-next " aria-label="Next page: Repository Priorities">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Plugins","level":"1.2.6","depth":2,"next":{"title":"Repository Priorities","level":"1.2.7","depth":2,"path":"articles/repository-priorities.md","ref":"articles/repository-priorities.md","articles":[]},"previous":{"title":"Handling Private Packages","level":"1.2.5","depth":2,"path":"articles/handling-private-packages.md","ref":"articles/handling-private-packages.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-highlight","-livereload","prism"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Composer 英文文档","language":"us-en","links":{"sidebar":{"Home":"https://docs.khs1994.com"}},"gitbook":"*"},"file":{"path":"articles/plugins.md","mtime":"2021-02-26T00:11:44.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-02-26T00:12:20.506Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

