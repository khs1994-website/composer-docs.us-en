
<!DOCTYPE HTML>
<html lang="us-en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Scripts · Composer 英文文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="troubleshooting.html" />
    
    
    <link rel="prev" href="resolving-merge-conflicts.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://docs.khs1994.com" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Articles
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="aliases.html">
            
                <a href="aliases.html">
            
                    
                    Aliases
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="authentication-for-private-packages.html">
            
                <a href="authentication-for-private-packages.html">
            
                    
                    Authentication For Private Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="autoloader-optimization.html">
            
                <a href="autoloader-optimization.html">
            
                    
                    Autoloader Optimization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="custom-installers.html">
            
                <a href="custom-installers.html">
            
                    
                    Custom Installers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="handling-private-packages.html">
            
                <a href="handling-private-packages.html">
            
                    
                    Handling Private Packages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="plugins.html">
            
                <a href="plugins.html">
            
                    
                    Plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="repository-priorities.html">
            
                <a href="repository-priorities.html">
            
                    
                    Repository Priorities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="resolving-merge-conflicts.html">
            
                <a href="resolving-merge-conflicts.html">
            
                    
                    Resolving Merge Conflicts
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.9" data-path="scripts.html">
            
                <a href="scripts.html">
            
                    
                    Scripts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="troubleshooting.html">
            
                <a href="troubleshooting.html">
            
                    
                    Troubleshooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="vendor-binaries.html">
            
                <a href="vendor-binaries.html">
            
                    
                    Vendor Binaries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="versions.html">
            
                <a href="versions.html">
            
                    
                    Versions
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Dev
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../dev/DefaultPolicy.html">
            
                <a href="../dev/DefaultPolicy.html">
            
                    
                    Default Policy
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Faqs
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../faqs/how-do-i-install-a-package-to-a-custom-path-for-my-framework.html">
            
                <a href="../faqs/how-do-i-install-a-package-to-a-custom-path-for-my-framework.html">
            
                    
                    How Do I Install A Package To A Custom Path For My Framework
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../faqs/how-to-install-composer-programmatically.html">
            
                <a href="../faqs/how-to-install-composer-programmatically.html">
            
                    
                    How To Install Composer Programmatically
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../faqs/how-to-install-untrusted-packages-safely.html">
            
                <a href="../faqs/how-to-install-untrusted-packages-safely.html">
            
                    
                    How To Install Untrusted Packages Safely
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../faqs/should-i-commit-the-dependencies-in-my-vendor-directory.html">
            
                <a href="../faqs/should-i-commit-the-dependencies-in-my-vendor-directory.html">
            
                    
                    Should I Commit The Dependencies In My Vendor Directory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../faqs/which-version-numbering-system-does-composer-itself-use.html">
            
                <a href="../faqs/which-version-numbering-system-does-composer-itself-use.html">
            
                    
                    Which Version Numbering System Does Composer Itself Use
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../faqs/why-are-unbound-version-constraints-a-bad-idea.html">
            
                <a href="../faqs/why-are-unbound-version-constraints-a-bad-idea.html">
            
                    
                    Why Are Unbound Version Constraints A Bad Idea
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../faqs/why-are-version-constraints-combining-comparisons-and-wildcards-a-bad-idea.html">
            
                <a href="../faqs/why-are-version-constraints-combining-comparisons-and-wildcards-a-bad-idea.html">
            
                    
                    Why Are Version Constraints Combining Comparisons And Wildcards A Bad Idea
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../faqs/why-can't-composer-load-repositories-recursively.html">
            
                <a href="../faqs/why-can't-composer-load-repositories-recursively.html">
            
                    
                    Why Can T Composer Load Repositories Recursively
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../fixtures/fixtures.html">
            
                <a href="../fixtures/fixtures.html">
            
                    
                    Fixtures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../01-basic-usage.html">
            
                <a href="../01-basic-usage.html">
            
                    
                    01 Basic Usage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../02-libraries.html">
            
                <a href="../02-libraries.html">
            
                    
                    02 Libraries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../03-cli.html">
            
                <a href="../03-cli.html">
            
                    
                    03 Cli
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../04-schema.html">
            
                <a href="../04-schema.html">
            
                    
                    04 Schema
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../05-repositories.html">
            
                <a href="../05-repositories.html">
            
                    
                    05 Repositories
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../06-config.html">
            
                <a href="../06-config.html">
            
                    
                    06 Config
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../07-runtime.html">
            
                <a href="../07-runtime.html">
            
                    
                    07 Runtime
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../08-community.html">
            
                <a href="../08-community.html">
            
                    
                    08 Community
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Scripts</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <!--
    tagline: Script are callbacks that are called before/after installing packages
-->
<h1 id="scripts">Scripts</h1>
<h2 id="what-is-a-script">What is a script?</h2>
<p>A script, in Composer&apos;s terms, can either be a PHP callback (defined as a
static method) or any command-line executable command. Scripts are useful
for executing a package&apos;s custom code or package-specific commands during
the Composer execution process.</p>
<blockquote>
<p><strong>Note:</strong> Only scripts defined in the root package&apos;s <code>composer.json</code> are
executed. If a dependency of the root package specifies its own scripts,
Composer does not execute those additional scripts.</p>
</blockquote>
<h2 id="event-names">Event names</h2>
<p>Composer fires the following named events during its execution process:</p>
<h3 id="command-events">Command Events</h3>
<ul>
<li><strong>pre-install-cmd</strong>: occurs before the <code>install</code> command is executed with a
lock file present.</li>
<li><strong>post-install-cmd</strong>: occurs after the <code>install</code> command has been executed
with a lock file present.</li>
<li><strong>pre-update-cmd</strong>: occurs before the <code>update</code> command is executed, or before
the <code>install</code> command is executed without a lock file present.</li>
<li><strong>post-update-cmd</strong>: occurs after the <code>update</code> command has been executed, or
after the <code>install</code> command has been executed without a lock file present.</li>
<li><strong>pre-status-cmd</strong>: occurs before the <code>status</code> command is executed.</li>
<li><strong>post-status-cmd</strong>: occurs after the <code>status</code> command has been executed.</li>
<li><strong>pre-archive-cmd</strong>: occurs before the <code>archive</code> command is executed.</li>
<li><strong>post-archive-cmd</strong>: occurs after the <code>archive</code> command has been executed.</li>
<li><strong>pre-autoload-dump</strong>: occurs before the autoloader is dumped, either during
<code>install</code>/<code>update</code>, or via the <code>dump-autoload</code> command.</li>
<li><strong>post-autoload-dump</strong>: occurs after the autoloader has been dumped, either
during <code>install</code>/<code>update</code>, or via the <code>dump-autoload</code> command.</li>
<li><strong>post-root-package-install</strong>: occurs after the root package has been
installed during the <code>create-project</code> command (but before its
dependencies are installed).</li>
<li><strong>post-create-project-cmd</strong>: occurs after the <code>create-project</code> command has
been executed.</li>
</ul>
<h3 id="installer-events">Installer Events</h3>
<ul>
<li><strong>pre-operations-exec</strong>: occurs before the install/upgrade/.. operations
are executed when installing a lock file.</li>
</ul>
<h3 id="package-events">Package Events</h3>
<ul>
<li><strong>pre-package-install</strong>: occurs before a package is installed.</li>
<li><strong>post-package-install</strong>: occurs after a package has been installed.</li>
<li><strong>pre-package-update</strong>: occurs before a package is updated.</li>
<li><strong>post-package-update</strong>: occurs after a package has been updated.</li>
<li><strong>pre-package-uninstall</strong>: occurs before a package is uninstalled.</li>
<li><strong>post-package-uninstall</strong>: occurs after a package has been uninstalled.</li>
</ul>
<h3 id="plugin-events">Plugin Events</h3>
<ul>
<li><strong>init</strong>: occurs after a Composer instance is done being initialized.</li>
<li><strong>command</strong>: occurs before any Composer Command is executed on the CLI. It
provides you with access to the input and output objects of the program.</li>
<li><strong>pre-file-download</strong>: occurs before files are downloaded and allows
you to manipulate the <code>HttpDownloader</code> object prior to downloading files
based on the URL to be downloaded.</li>
<li><strong>post-file-download</strong>: occurs after package dist files are downloaded and
allows you to perform additional checks on the file if required.</li>
<li><strong>pre-command-run</strong>: occurs before a command is executed and allows you to
manipulate the <code>InputInterface</code> object&apos;s options and arguments to tweak
a command&apos;s behavior.</li>
<li><strong>pre-pool-create</strong>: occurs before the Pool of packages is created, and lets
you filter the list of packages which is going to enter the Solver.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> Composer makes no assumptions about the state of your dependencies
prior to <code>install</code> or <code>update</code>. Therefore, you should not specify scripts
that require Composer-managed dependencies in the <code>pre-update-cmd</code> or
<code>pre-install-cmd</code> event hooks. If you need to execute scripts prior to
<code>install</code> or <code>update</code> please make sure they are self-contained within your
root package.</p>
</blockquote>
<h2 id="defining-scripts">Defining scripts</h2>
<p>The root JSON object in <code>composer.json</code> should have a property called
<code>&quot;scripts&quot;</code>, which contains pairs of named events and each event&apos;s
corresponding scripts. An event&apos;s scripts can be defined as either a string
(only for a single script) or an array (for single or multiple scripts.)</p>
<p>For any given event:</p>
<ul>
<li>Scripts execute in the order defined when their corresponding event is fired.</li>
<li>An array of scripts wired to a single event can contain both PHP callbacks
and command-line executable commands.</li>
<li>PHP classes containing defined callbacks must be autoloadable via Composer&apos;s
autoload functionality.</li>
<li>Callbacks can only autoload classes from psr-0, psr-4 and classmap
definitions. If a defined callback relies on functions defined outside of a
class, the callback itself is responsible for loading the file containing these
functions.</li>
</ul>
<p>Script definition example:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;post-update-cmd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MyVendor\\MyClass::postUpdate&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;post-package-install&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;MyVendor\\MyClass::postPackageInstall&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;post-install-cmd&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;MyVendor\\MyClass::warmCache&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;phpunit -c app/&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;post-autoload-dump&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;MyVendor\\MyClass::postAutoloadDump&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;post-create-project-cmd&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;php -r \&quot;copy(&apos;config/local-example.php&apos;, &apos;config/local.php&apos;);\&quot;&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Using the previous definition example, here&apos;s the class <code>MyVendor\MyClass</code>
that might be used to execute the PHP callbacks:</p>
<pre class="language-"><code class="lang-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">MyVendor</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Script<span class="token punctuation">\</span>Event</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Composer<span class="token punctuation">\</span>Installer<span class="token punctuation">\</span>PackageEvent</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyClass</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">postUpdate</span><span class="token punctuation">(</span>Event <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$composer</span> <span class="token operator">=</span> <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getComposer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// do stuff</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">postAutoloadDump</span><span class="token punctuation">(</span>Event <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$vendorDir</span> <span class="token operator">=</span> <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getComposer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token single-quoted-string string">&apos;vendor-dir&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span> <span class="token variable">$vendorDir</span> <span class="token punctuation">.</span> <span class="token single-quoted-string string">&apos;/autoload.php&apos;</span><span class="token punctuation">;</span>

        <span class="token function">some_function_from_an_autoloaded_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">postPackageInstall</span><span class="token punctuation">(</span>PackageEvent <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$installedPackage</span> <span class="token operator">=</span> <span class="token variable">$event</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getPackage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// do stuff</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">warmCache</span><span class="token punctuation">(</span>Event <span class="token variable">$event</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// make cache toasty</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Note:</strong> During a Composer <code>install</code> or <code>update</code> command run, a variable named
<code>COMPOSER_DEV_MODE</code> will be added to the environment. If the command was run
with the <code>--no-dev</code> flag, this variable will be set to 0, otherwise it will be
set to 1. The variable is also available while <code>dump-autoload</code> runs, and it
will be set to same as the last <code>install</code> or <code>update</code> was run in.</p>
<h2 id="event-classes">Event classes</h2>
<p>When an event is fired, your PHP callback receives as first argument a
<code>Composer\EventDispatcher\Event</code> object. This object has a <code>getName()</code> method
that lets you retrieve the event name.</p>
<p>Depending on the <a href="#event-names">script types</a> you will get various event
subclasses containing various getters with relevant data and associated
objects:</p>
<ul>
<li>Base class: <a href="https://getcomposer.org/apidoc/master/Composer/EventDispatcher/Event.html" target="_blank"><code>Composer\EventDispatcher\Event</code></a></li>
<li>Command Events: <a href="https://getcomposer.org/apidoc/master/Composer/Script/Event.html" target="_blank"><code>Composer\Script\Event</code></a></li>
<li>Installer Events: <a href="https://getcomposer.org/apidoc/master/Composer/Installer/InstallerEvent.html" target="_blank"><code>Composer\Installer\InstallerEvent</code></a></li>
<li>Package Events: <a href="https://getcomposer.org/apidoc/master/Composer/Installer/PackageEvent.html" target="_blank"><code>Composer\Installer\PackageEvent</code></a></li>
<li>Plugin Events:<ul>
<li>init: <a href="https://getcomposer.org/apidoc/master/Composer/EventDispatcher/Event.html" target="_blank"><code>Composer\EventDispatcher\Event</code></a></li>
<li>command: <a href="https://getcomposer.org/apidoc/master/Composer/Plugin/CommandEvent.html" target="_blank"><code>Composer\Plugin\CommandEvent</code></a></li>
<li>pre-file-download: <a href="https://getcomposer.org/apidoc/master/Composer/Plugin/PreFileDownloadEvent.html" target="_blank"><code>Composer\Plugin\PreFileDownloadEvent</code></a></li>
<li>post-file-download: <a href="https://getcomposer.org/apidoc/master/Composer/Plugin/PostFileDownloadEvent.html" target="_blank"><code>Composer\Plugin\PostFileDownloadEvent</code></a></li>
</ul>
</li>
</ul>
<h2 id="running-scripts-manually">Running scripts manually</h2>
<p>If you would like to run the scripts for an event manually, the syntax is:</p>
<pre class="language-"><code class="lang-sh">composer run-script <span class="token punctuation">[</span>--dev<span class="token punctuation">]</span> <span class="token punctuation">[</span>--no-dev<span class="token punctuation">]</span> script
</code></pre>
<p>For example <code>composer run-script post-install-cmd</code> will run any
<strong>post-install-cmd</strong> scripts and <a href="plugins.html">plugins</a> that have been defined.</p>
<p>You can also give additional arguments to the script handler by appending <code>--</code>
followed by the handler arguments. e.g.
<code>composer run-script post-install-cmd -- --check</code> will pass<code>--check</code> along to
the script handler. Those arguments are received as CLI arg by CLI handlers,
and can be retrieved as an array via <code>$event-&gt;getArguments()</code> by PHP handlers.</p>
<h2 id="writing-custom-commands">Writing custom commands</h2>
<p>If you add custom scripts that do not fit one of the predefined event name
above, you can either run them with run-script or also run them as native
Composer commands. For example the handler defined below is executable by
running <code>composer test</code>:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;phpunit&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Similar to the <code>run-script</code> command you can give additional arguments to scripts,
e.g. <code>composer test -- --filter <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span></code> will pass <code>--filter <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span></code> along
to the <code>phpunit</code> script.</p>
<blockquote>
<p><strong>Note:</strong> Before executing scripts, Composer&apos;s bin-dir is temporarily pushed
on top of the PATH environment variable so that binaries of dependencies
are directly accessible. In this example no matter if the <code>phpunit</code> binary is
actually in <code>vendor/bin/phpunit</code> or <code>bin/phpunit</code> it will be found and executed.</p>
</blockquote>
<p>Although Composer is not intended to manage long-running processes and other
such aspects of PHP projects, it can sometimes be handy to disable the process
timeout on custom commands. This timeout defaults to 300 seconds and can be
overridden in a variety of ways depending on the desired effect:</p>
<ul>
<li>disable it for all commands using the config key <code>process-timeout</code>,</li>
<li>disable it for the current or future invocations of composer using the
environment variable <code>COMPOSER_PROCESS_TIMEOUT</code>,</li>
<li>for a specific invocation using the <code>--timeout</code> flag of the <code>run-script</code> command,</li>
<li>using a static helper for specific scripts.</li>
</ul>
<p>To disable the timeout for specific scripts with the static helper directly in
composer.json:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;Composer\\Config::disableProcessTimeout&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;phpunit&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>To disable the timeout for every script on a given project, you can use the
composer.json configuration:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token property">&quot;config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;process-timeout&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>It&apos;s also possible to set the global environment variable to disable the timeout
of all following scripts in the current terminal environment:</p>
<pre class="language-"><code>export COMPOSER_PROCESS_TIMEOUT=0
</code></pre><p>To disable the timeout of a single script call, you must use the <code>run-script</code> composer
command and specify the <code>--timeout</code> parameter:</p>
<pre class="language-"><code>composer run-script --timeout=0 test
</code></pre><h2 id="referencing-scripts">Referencing scripts</h2>
<p>To enable script re-use and avoid duplicates, you can call a script from another
one by prefixing the command name with <code>@</code>:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;@clearCache&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;phpunit&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;clearCache&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rm -rf cache/*&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You can also refer a script and pass it new arguments:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;tests&quot;</span><span class="token operator">:</span> <span class="token string">&quot;phpunit&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;testsVerbose&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@tests -vvv&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="calling-composer-commands">Calling Composer commands</h2>
<p>To call Composer commands, you can use <code>@composer</code> which will automatically
resolve to whatever composer.phar is currently being used:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;@composer install&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;phpunit&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>One limitation of this is that you can not call multiple composer commands in
a row like <code>@composer install &amp;&amp; @composer foo</code>. You must split them up in a
JSON array of commands.</p>
<h2 id="executing-php-scripts">Executing PHP scripts</h2>
<p>To execute PHP scripts, you can use <code>@php</code> which will automatically
resolve to whatever php process is currently being used:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;@php script.php&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;phpunit&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>One limitation of this is that you can not call multiple commands in
a row like <code>@php install &amp;&amp; @php foo</code>. You must split them up in a
JSON array of commands.</p>
<p>You can also call a shell/bash script, which will have the path to
the PHP executable available in it as a <code>PHP_BINARY</code> env var.</p>
<h2 id="setting-environment-variables">Setting environment variables</h2>
<p>To set an environment variable in a cross-platform way, you can use <code>@putenv</code>:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;install-phpstan&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;@putenv COMPOSER=phpstan-composer.json&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;composer install --prefer-dist&quot;</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="custom-descriptions">Custom descriptions.</h2>
<p>You can set custom script descriptions with the following in your <code>composer.json</code>:</p>
<pre class="language-"><code class="lang-json"><span class="token punctuation">{</span>
    <span class="token property">&quot;scripts-descriptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Run all tests!&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The descriptions are used in <code>composer list</code> or <code>composer run -l</code> commands to
describe what the scripts do when the command is run.</p>
<blockquote>
<p><strong>Note:</strong> You can only set custom descriptions of custom commands.</p>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="resolving-merge-conflicts.html" class="navigation navigation-prev " aria-label="Previous page: Resolving Merge Conflicts">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="troubleshooting.html" class="navigation navigation-next " aria-label="Next page: Troubleshooting">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Scripts","level":"1.2.9","depth":2,"next":{"title":"Troubleshooting","level":"1.2.10","depth":2,"path":"articles/troubleshooting.md","ref":"articles/troubleshooting.md","articles":[]},"previous":{"title":"Resolving Merge Conflicts","level":"1.2.8","depth":2,"path":"articles/resolving-merge-conflicts.md","ref":"articles/resolving-merge-conflicts.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-highlight","-livereload","prism"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Composer 英文文档","language":"us-en","links":{"sidebar":{"Home":"https://docs.khs1994.com"}},"gitbook":"*"},"file":{"path":"articles/scripts.md","mtime":"2021-02-26T00:11:44.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-02-26T00:12:20.506Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

